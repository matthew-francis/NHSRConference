---
title: "R Markdown workshop"
output:
  word_document:
    reference_doc: mytemplate.docx
    toc: yes
params:
  age: 15
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

---------------------
  
  


# Introduction to R Markdown

R Markdown allows you to automate and format documents in HTML, PDF and Word documents as well as allowing the development of Power Point slidesets. In this session we will focus on the generation of Word documents.

When you first open a markdown script, the basic script doesn't do much and doesn't look great.

However, there is so much we can do in R Markdown.

# Working with the title page
  
## Add a table of contents
  
We can add a table of contents. Below the output: command, simply add:

    word_document:
      toc: yes
    
Ensure the toc: yes is indented otherwise this will not work.    

## Add a template
  
At the moment, the markdown file doesn't look great. We can add a reference template. This maybe a template with business/organisation logos for example.

To add a template, ensure it is saved in your project folder, and under the output: command, add


output:

  word_document: 
 
    reference_doc: mytemplate.docx 
      toc: yes 
    
# Headers

In markdown, headers can be created using #. # will create the first level header, ## the second level header, ### the third and so on.

i.e
  
  \newline
  
# This is header 1

## This is header 2

### This is header 3

#### And so on
  \newline

# Adding new lines
If your paragraphs look too clustered, add blank lines to the document by indenting and typing `\newline`

  \newline

              
# Embed some data

In R, we can read datasets in, aggregate etc exactly as we would do in a basic R script. The echo=TRUE element allows markdown to display the r code. If this was set to FALSE the r code chunk would not be displayed.

```{r, readdata, echo=TRUE}
# read in the example dataset

patients<-read.csv("PatientData.csv")


```

This data has been loaded and we can set libraries and run some code.

  \newline
  
How many records are in the dataset?

  \newline
  
```{r echo=FALSE}  
recs<-nrow(patients)

```

  \newline
  
There are `r recs` records in the patients dataset.

  \newline

What are the field names in te patients dataset?

  \newline
  
```{r echo=TRUE}  

df_names<-names(patients)


```


The field names are:

  \newline
  
`r df_names`

  \newline

What was the average height, weight and age?

```{r echo=TRUE}
library(dplyr)

summary_stats<-patients%>%
            summarise(m_age=round(mean(Age),1),m_ht= round(mean(Height),1),m_wt=round(mean(Weight),1))


```

  \newline
  
`r summary_stats`

  \newline
  

  \newline
  

Doesn't look to impressive. Let's tidy it up.

  \newline
  
```{r echo=TRUE}
library(flextable)
tble<-flextable(summary_stats,
                col_keys = c("m_age","m_ht","m_wt"))

tble
```  


# Insert a graph


  
  
  \newline
  
As well as including calculations we can also add in graphs.
For example, using the patients dataset, let's make a scatterplot of Height and Weight.

  \newline
  
```{r echo=TRUE}
library(ggplot2)
my_scatter<-ggplot(patients, aes(x=Weight, y=Height))+
    geom_point()
    
my_scatter
```

  \newline
  
# Working with parameters

  \newline
  
We can pass parameters into RMarkdown automation scripts. In the header, under the output: section, add a params: section. In this example we have set

```{r echo=TRUE}
age_g<-params$age

```

Age is equal to `r params$age`

  \newline

Now we can do soemthing with this. We can pass this parameter into the patients data to filter.

```{r echo=TRUE}
patients_filter<-patients%>%
                filter(Age==params$age)
  
patients_filter
```

  \newline

# Images and pictures
  
Finally, let's put an image .png in:

  \newline
  \newline
  \newline
  
```{r echo=TRUE}
library(knitr)
include_graphics("logo.png")

```

  \newline
  \newline
  \newline
Hope this has been helpful!

Find more information at https://rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf

A great resource for formatting tables : https://cran.r-project.org/web/packages/flextable/vignettes/overview.html

Thanks for listening